{"version":3,"sources":["coco-ssd.node.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar tfconv = require('@tensorflow/tfjs-converter');\nvar tf = require('@tensorflow/tfjs-core');\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\n\n/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nvar CLASSES = {\n    1: {\n        name: '/m/01g317',\n        id: 1,\n        displayName: 'person',\n    },\n    2: {\n        name: '/m/0199g',\n        id: 2,\n        displayName: 'bicycle',\n    },\n    3: {\n        name: '/m/0k4j',\n        id: 3,\n        displayName: 'car',\n    },\n    4: {\n        name: '/m/04_sv',\n        id: 4,\n        displayName: 'motorcycle',\n    },\n    5: {\n        name: '/m/05czz6l',\n        id: 5,\n        displayName: 'airplane',\n    },\n    6: {\n        name: '/m/01bjv',\n        id: 6,\n        displayName: 'bus',\n    },\n    7: {\n        name: '/m/07jdr',\n        id: 7,\n        displayName: 'train',\n    },\n    8: {\n        name: '/m/07r04',\n        id: 8,\n        displayName: 'truck',\n    },\n    9: {\n        name: '/m/019jd',\n        id: 9,\n        displayName: 'boat',\n    },\n    10: {\n        name: '/m/015qff',\n        id: 10,\n        displayName: 'traffic light',\n    },\n    11: {\n        name: '/m/01pns0',\n        id: 11,\n        displayName: 'fire hydrant',\n    },\n    13: {\n        name: '/m/02pv19',\n        id: 13,\n        displayName: 'stop sign',\n    },\n    14: {\n        name: '/m/015qbp',\n        id: 14,\n        displayName: 'parking meter',\n    },\n    15: {\n        name: '/m/0cvnqh',\n        id: 15,\n        displayName: 'bench',\n    },\n    16: {\n        name: '/m/015p6',\n        id: 16,\n        displayName: 'bird',\n    },\n    17: {\n        name: '/m/01yrx',\n        id: 17,\n        displayName: 'cat',\n    },\n    18: {\n        name: '/m/0bt9lr',\n        id: 18,\n        displayName: 'dog',\n    },\n    19: {\n        name: '/m/03k3r',\n        id: 19,\n        displayName: 'horse',\n    },\n    20: {\n        name: '/m/07bgp',\n        id: 20,\n        displayName: 'sheep',\n    },\n    21: {\n        name: '/m/01xq0k1',\n        id: 21,\n        displayName: 'cow',\n    },\n    22: {\n        name: '/m/0bwd_0j',\n        id: 22,\n        displayName: 'elephant',\n    },\n    23: {\n        name: '/m/01dws',\n        id: 23,\n        displayName: 'bear',\n    },\n    24: {\n        name: '/m/0898b',\n        id: 24,\n        displayName: 'zebra',\n    },\n    25: {\n        name: '/m/03bk1',\n        id: 25,\n        displayName: 'giraffe',\n    },\n    27: {\n        name: '/m/01940j',\n        id: 27,\n        displayName: 'backpack',\n    },\n    28: {\n        name: '/m/0hnnb',\n        id: 28,\n        displayName: 'umbrella',\n    },\n    31: {\n        name: '/m/080hkjn',\n        id: 31,\n        displayName: 'handbag',\n    },\n    32: {\n        name: '/m/01rkbr',\n        id: 32,\n        displayName: 'tie',\n    },\n    33: {\n        name: '/m/01s55n',\n        id: 33,\n        displayName: 'suitcase',\n    },\n    34: {\n        name: '/m/02wmf',\n        id: 34,\n        displayName: 'frisbee',\n    },\n    35: {\n        name: '/m/071p9',\n        id: 35,\n        displayName: 'skis',\n    },\n    36: {\n        name: '/m/06__v',\n        id: 36,\n        displayName: 'snowboard',\n    },\n    37: {\n        name: '/m/018xm',\n        id: 37,\n        displayName: 'sports ball',\n    },\n    38: {\n        name: '/m/02zt3',\n        id: 38,\n        displayName: 'kite',\n    },\n    39: {\n        name: '/m/03g8mr',\n        id: 39,\n        displayName: 'baseball bat',\n    },\n    40: {\n        name: '/m/03grzl',\n        id: 40,\n        displayName: 'baseball glove',\n    },\n    41: {\n        name: '/m/06_fw',\n        id: 41,\n        displayName: 'skateboard',\n    },\n    42: {\n        name: '/m/019w40',\n        id: 42,\n        displayName: 'surfboard',\n    },\n    43: {\n        name: '/m/0dv9c',\n        id: 43,\n        displayName: 'tennis racket',\n    },\n    44: {\n        name: '/m/04dr76w',\n        id: 44,\n        displayName: 'bottle',\n    },\n    46: {\n        name: '/m/09tvcd',\n        id: 46,\n        displayName: 'wine glass',\n    },\n    47: {\n        name: '/m/08gqpm',\n        id: 47,\n        displayName: 'cup',\n    },\n    48: {\n        name: '/m/0dt3t',\n        id: 48,\n        displayName: 'fork',\n    },\n    49: {\n        name: '/m/04ctx',\n        id: 49,\n        displayName: 'knife',\n    },\n    50: {\n        name: '/m/0cmx8',\n        id: 50,\n        displayName: 'spoon',\n    },\n    51: {\n        name: '/m/04kkgm',\n        id: 51,\n        displayName: 'bowl',\n    },\n    52: {\n        name: '/m/09qck',\n        id: 52,\n        displayName: 'banana',\n    },\n    53: {\n        name: '/m/014j1m',\n        id: 53,\n        displayName: 'apple',\n    },\n    54: {\n        name: '/m/0l515',\n        id: 54,\n        displayName: 'sandwich',\n    },\n    55: {\n        name: '/m/0cyhj_',\n        id: 55,\n        displayName: 'orange',\n    },\n    56: {\n        name: '/m/0hkxq',\n        id: 56,\n        displayName: 'broccoli',\n    },\n    57: {\n        name: '/m/0fj52s',\n        id: 57,\n        displayName: 'carrot',\n    },\n    58: {\n        name: '/m/01b9xk',\n        id: 58,\n        displayName: 'hot dog',\n    },\n    59: {\n        name: '/m/0663v',\n        id: 59,\n        displayName: 'pizza',\n    },\n    60: {\n        name: '/m/0jy4k',\n        id: 60,\n        displayName: 'donut',\n    },\n    61: {\n        name: '/m/0fszt',\n        id: 61,\n        displayName: 'cake',\n    },\n    62: {\n        name: '/m/01mzpv',\n        id: 62,\n        displayName: 'chair',\n    },\n    63: {\n        name: '/m/02crq1',\n        id: 63,\n        displayName: 'couch',\n    },\n    64: {\n        name: '/m/03fp41',\n        id: 64,\n        displayName: 'potted plant',\n    },\n    65: {\n        name: '/m/03ssj5',\n        id: 65,\n        displayName: 'bed',\n    },\n    67: {\n        name: '/m/04bcr3',\n        id: 67,\n        displayName: 'dining table',\n    },\n    70: {\n        name: '/m/09g1w',\n        id: 70,\n        displayName: 'toilet',\n    },\n    72: {\n        name: '/m/07c52',\n        id: 72,\n        displayName: 'tv',\n    },\n    73: {\n        name: '/m/01c648',\n        id: 73,\n        displayName: 'laptop',\n    },\n    74: {\n        name: '/m/020lf',\n        id: 74,\n        displayName: 'mouse',\n    },\n    75: {\n        name: '/m/0qjjc',\n        id: 75,\n        displayName: 'remote',\n    },\n    76: {\n        name: '/m/01m2v',\n        id: 76,\n        displayName: 'keyboard',\n    },\n    77: {\n        name: '/m/050k8',\n        id: 77,\n        displayName: 'cell phone',\n    },\n    78: {\n        name: '/m/0fx9l',\n        id: 78,\n        displayName: 'microwave',\n    },\n    79: {\n        name: '/m/029bxz',\n        id: 79,\n        displayName: 'oven',\n    },\n    80: {\n        name: '/m/01k6s3',\n        id: 80,\n        displayName: 'toaster',\n    },\n    81: {\n        name: '/m/0130jx',\n        id: 81,\n        displayName: 'sink',\n    },\n    82: {\n        name: '/m/040b_t',\n        id: 82,\n        displayName: 'refrigerator',\n    },\n    84: {\n        name: '/m/0bt_c3',\n        id: 84,\n        displayName: 'book',\n    },\n    85: {\n        name: '/m/01x3z',\n        id: 85,\n        displayName: 'clock',\n    },\n    86: {\n        name: '/m/02s195',\n        id: 86,\n        displayName: 'vase',\n    },\n    87: {\n        name: '/m/01lsmm',\n        id: 87,\n        displayName: 'scissors',\n    },\n    88: {\n        name: '/m/0kmg4',\n        id: 88,\n        displayName: 'teddy bear',\n    },\n    89: {\n        name: '/m/03wvsk',\n        id: 89,\n        displayName: 'hair drier',\n    },\n    90: {\n        name: '/m/012xff',\n        id: 90,\n        displayName: 'toothbrush',\n    }\n};\n\n/** @license See the LICENSE file. */\n// This code is auto-generated, do not modify this file!\nvar version = '2.1.0';\n\n/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nvar BASE_PATH = 'https://storage.googleapis.com/tfjs-models/savedmodel/';\nfunction load(config) {\n    if (config === void 0) { config = {}; }\n    return __awaiter(this, void 0, void 0, function () {\n        var base, modelUrl, objectDetection;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (tf == null) {\n                        throw new Error(\"Cannot find TensorFlow.js. If you are using a <script> tag, please \" +\n                            \"also include @tensorflow/tfjs on the page before using this model.\");\n                    }\n                    base = config.base || 'lite_mobilenet_v2';\n                    modelUrl = config.modelUrl;\n                    if (['mobilenet_v1', 'mobilenet_v2', 'lite_mobilenet_v2'].indexOf(base) ===\n                        -1) {\n                        throw new Error(\"ObjectDetection constructed with invalid base model \" +\n                            (base + \". Valid names are 'mobilenet_v1',\") +\n                            \" 'mobilenet_v2' and 'lite_mobilenet_v2'.\");\n                    }\n                    objectDetection = new ObjectDetection(base, modelUrl);\n                    return [4 /*yield*/, objectDetection.load()];\n                case 1:\n                    _a.sent();\n                    return [2 /*return*/, objectDetection];\n            }\n        });\n    });\n}\nvar ObjectDetection = /** @class */ (function () {\n    function ObjectDetection(base, modelUrl) {\n        this.modelPath =\n            modelUrl || \"\" + BASE_PATH + this.getPrefix(base) + \"/model.json\";\n    }\n    ObjectDetection.prototype.getPrefix = function (base) {\n        return base === 'lite_mobilenet_v2' ? \"ssd\" + base : \"ssd_\" + base;\n    };\n    ObjectDetection.prototype.load = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, zeroTensor, result;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this;\n                        return [4 /*yield*/, tfconv.loadGraphModel(this.modelPath)];\n                    case 1:\n                        _a.model = _b.sent();\n                        zeroTensor = tf.zeros([1, 300, 300, 3], 'int32');\n                        return [4 /*yield*/, this.model.executeAsync(zeroTensor)];\n                    case 2:\n                        result = _b.sent();\n                        return [4 /*yield*/, Promise.all(result.map(function (t) { return t.data(); }))];\n                    case 3:\n                        _b.sent();\n                        result.map(function (t) { return t.dispose(); });\n                        zeroTensor.dispose();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Infers through the model.\n     *\n     * @param img The image to classify. Can be a tensor or a DOM element image,\n     * video, or canvas.\n     * @param maxNumBoxes The maximum number of bounding boxes of detected\n     * objects. There can be multiple objects of the same class, but at different\n     * locations. Defaults to 20.\n     * @param minScore The minimum score of the returned bounding boxes\n     * of detected objects. Value between 0 and 1. Defaults to 0.5.\n     */\n    ObjectDetection.prototype.infer = function (img, maxNumBoxes, minScore) {\n        return __awaiter(this, void 0, void 0, function () {\n            var batched, height, width, result, scores, boxes, _a, maxScores, classes, prevBackend, indexTensor, indexes;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        batched = tf.tidy(function () {\n                            if (!(img instanceof tf.Tensor)) {\n                                img = tf.browser.fromPixels(img);\n                            }\n                            // Reshape to a single-element batch so we can pass it to executeAsync.\n                            return img.expandDims(0);\n                        });\n                        height = batched.shape[1];\n                        width = batched.shape[2];\n                        return [4 /*yield*/, this.model.executeAsync(batched)];\n                    case 1:\n                        result = _b.sent();\n                        scores = result[0].dataSync();\n                        boxes = result[1].dataSync();\n                        // clean the webgl tensors\n                        batched.dispose();\n                        tf.dispose(result);\n                        _a = this.calculateMaxScores(scores, result[0].shape[1], result[0].shape[2]), maxScores = _a[0], classes = _a[1];\n                        prevBackend = tf.getBackend();\n                        // run post process in cpu\n                        tf.setBackend('cpu');\n                        indexTensor = tf.tidy(function () {\n                            var boxes2 = tf.tensor2d(boxes, [result[1].shape[1], result[1].shape[3]]);\n                            return tf.image.nonMaxSuppression(boxes2, maxScores, maxNumBoxes, minScore, minScore);\n                        });\n                        indexes = indexTensor.dataSync();\n                        indexTensor.dispose();\n                        // restore previous backend\n                        tf.setBackend(prevBackend);\n                        return [2 /*return*/, this.buildDetectedObjects(width, height, boxes, maxScores, indexes, classes)];\n                }\n            });\n        });\n    };\n    ObjectDetection.prototype.buildDetectedObjects = function (width, height, boxes, scores, indexes, classes) {\n        var count = indexes.length;\n        var objects = [];\n        for (var i = 0; i < count; i++) {\n            var bbox = [];\n            for (var j = 0; j < 4; j++) {\n                bbox[j] = boxes[indexes[i] * 4 + j];\n            }\n            var minY = bbox[0] * height;\n            var minX = bbox[1] * width;\n            var maxY = bbox[2] * height;\n            var maxX = bbox[3] * width;\n            bbox[0] = minX;\n            bbox[1] = minY;\n            bbox[2] = maxX - minX;\n            bbox[3] = maxY - minY;\n            objects.push({\n                bbox: bbox,\n                class: CLASSES[classes[indexes[i]] + 1].displayName,\n                score: scores[indexes[i]]\n            });\n        }\n        return objects;\n    };\n    ObjectDetection.prototype.calculateMaxScores = function (scores, numBoxes, numClasses) {\n        var maxes = [];\n        var classes = [];\n        for (var i = 0; i < numBoxes; i++) {\n            var max = Number.MIN_VALUE;\n            var index = -1;\n            for (var j = 0; j < numClasses; j++) {\n                if (scores[i * numClasses + j] > max) {\n                    max = scores[i * numClasses + j];\n                    index = j;\n                }\n            }\n            maxes[i] = max;\n            classes[i] = index;\n        }\n        return [maxes, classes];\n    };\n    /**\n     * Detect objects for an image returning a list of bounding boxes with\n     * assocated class and score.\n     *\n     * @param img The image to detect objects from. Can be a tensor or a DOM\n     *     element image, video, or canvas.\n     * @param maxNumBoxes The maximum number of bounding boxes of detected\n     * objects. There can be multiple objects of the same class, but at different\n     * locations. Defaults to 20.\n     * @param minScore The minimum score of the returned bounding boxes\n     * of detected objects. Value between 0 and 1. Defaults to 0.5.\n     */\n    ObjectDetection.prototype.detect = function (img, maxNumBoxes, minScore) {\n        if (maxNumBoxes === void 0) { maxNumBoxes = 20; }\n        if (minScore === void 0) { minScore = 0.5; }\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.infer(img, maxNumBoxes, minScore)];\n            });\n        });\n    };\n    /**\n     * Dispose the tensors allocated by the model. You should call this when you\n     * are done with the model.\n     */\n    ObjectDetection.prototype.dispose = function () {\n        if (this.model != null) {\n            this.model.dispose();\n        }\n    };\n    return ObjectDetection;\n}());\n\nexports.ObjectDetection = ObjectDetection;\nexports.load = load;\nexports.version = version;\n//# sourceMappingURL=coco-ssd.node.js.map\n"]}